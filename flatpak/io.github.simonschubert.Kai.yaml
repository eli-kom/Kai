app-id: io.github.simonschubert.Kai
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: kai-wrapper

finish-args:
  - --share=network
  - --socket=x11
  - --socket=wayland
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --persist=.kai
  - --persist=.java

modules:
  - name: kai
    buildsystem: simple
    build-commands:
      # Extract and install the application
      - tar xf Kai-linux-x86_64.tar.gz
      - mkdir -p /app/lib/kai
      - cp -r Kai/* /app/lib/kai/

      # Install wrapper script
      - install -Dm755 kai-wrapper.sh /app/bin/kai-wrapper

      # Install desktop file
      - install -Dm644 io.github.simonschubert.Kai.desktop /app/share/applications/io.github.simonschubert.Kai.desktop

      # Install metainfo
      - install -Dm644 io.github.simonschubert.Kai.metainfo.xml /app/share/metainfo/io.github.simonschubert.Kai.metainfo.xml

      # Install icons
      - install -Dm644 icon.svg /app/share/icons/hicolor/scalable/apps/io.github.simonschubert.Kai.svg
      - install -Dm644 icon.png /app/share/icons/hicolor/512x512/apps/io.github.simonschubert.Kai.png

    sources:
      - type: file
        url: https://github.com/SimonSchubert/Kai/releases/download/v1.7.2/Kai-1.7.2-linux-x86_64.tar.gz
        sha256: 3e5f81bdf4ec2fd31295b9d52858291441dd8d36df5e0a9df535599f072fac0b
        dest-filename: Kai-linux-x86_64.tar.gz
        x-checker-data:
          type: json
          url: https://api.github.com/repos/SimonSchubert/Kai/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: .assets[] | select(.name | test("linux-x86_64\\.tar\\.gz$")) | .browser_download_url

      - type: file
        path: io.github.simonschubert.Kai.desktop

      - type: file
        path: io.github.simonschubert.Kai.metainfo.xml

      - type: file
        path: ../composeApp/icon.svg

      - type: file
        path: ../composeApp/icon.png

      - type: script
        dest-filename: kai-wrapper.sh
        commands:
          - export PATH="/app/lib/kai/bin:${PATH}"
          - export LD_LIBRARY_PATH="/app/lib/kai/lib/runtime/lib:${LD_LIBRARY_PATH}"
          - exec /app/lib/kai/bin/Kai "$@"
